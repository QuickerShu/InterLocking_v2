# プログラムの破綻・不足・改善点レビュー

## 1. テキストラベルの永続化・復元機能が未実装
- テキストラベル（`.text-label`）はDOM要素として動的に生成されるが、レイアウトのエクスポート（JSON保存）やインポート（読込）時に保存・復元されない。
- ページをリロードしたりレイアウトを再読込すると、配置したテキストラベルが消えてしまう。
- **改善案**：テキストラベルの内容・位置・スタイル情報もレイアウトデータに含めて保存・復元できるようにする。

## 2. グローバル変数への依存が多い
- `window.app`や`window.routeManager`など、グローバル変数に多く依存している。
- これにより、テストや拡張、複数インスタンスの管理が難しくなる。
- **改善案**：グローバル変数の使用を減らし、クラス間の依存注入やモジュール化を進める。

## 3. イベントリスナーの重複登録・解除漏れの懸念
- 動的に生成されるボタンや、`DOMContentLoaded`の複数回発火などで、イベントリスナーが重複登録される可能性がある。
- 配置キャンセル時のイベントリスナー解除処理が複雑で、漏れが発生するリスクがある。
- **改善案**：イベントリスナーの登録・解除を一元管理し、重複や解除漏れを防ぐ。

## 4. ファイル読込時のバリデーション・エラーハンドリング不足
- レイアウト読込時（JSONパース時）に、データ構造のバリデーションやエラー時の詳細なメッセージ表示が不足している。
- 不正なデータやバージョン違いのファイルを読み込んだ場合、アプリが不安定になる可能性がある。
- **改善案**：読込時にデータの整合性チェックやバージョンチェックを行い、エラー時はユーザーに分かりやすいメッセージを表示する。

## 5. UIメッセージの国際化（i18n）未対応
- UIメッセージやボタンラベルが日本語でハードコーディングされている。
- 多言語対応が必要な場合、i18n対応が困難。
- **改善案**：メッセージやラベルを外部ファイルや定数で管理し、i18n対応を進める。

## 6. ユニットテスト・自動テストが未整備
- 現状、ユニットテストや自動テストの記述が見当たらない。
- バグの早期発見やリファクタリング時の安全性確保のため、テストコードの整備が望まれる。
- **改善案**：主要なクラス・関数についてテストコードを追加する。

## 7. パーツ配置・連動要素配置の処理が重複
- `setupToolbar`内で、パーツ配置・連動要素配置の処理が個別に記述されており、重複が多い。
- **改善案**：共通化・関数化して、保守性を高める。

## 8. 操作モード切替時のユーザーガイダンスが不十分
- 編集モード・操作モードの切替時、現在の状態や次の操作手順が分かりづらい場合がある。
- **改善案**：ステータスバーやダイアログで、より明確なガイダンスを表示する。

## 9. コードの肥大化・責務の分散不足
- `App`クラスが非常に大きく、UI制御・データ管理・イベント処理など多くの責務を持っている。
- **改善案**：機能ごとにクラスやモジュールを分割し、責務を明確にする。

## 10. 例外処理・エラー通知の一貫性不足
- 例外発生時の通知方法やUI反映が一貫していない。
- **改善案**：エラー発生時は必ずユーザーに通知し、必要に応じてリカバリ手段を提示する。 